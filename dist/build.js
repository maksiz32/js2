new Vue({el:"#app",data:{goods:[],filteredGoods:[],isVisibleCart:!1,errorText:"",basketItems:[]},methods:{makeGETRequest(t){return fetch(t).then((t=>t.json())).catch((t=>{this.errorText="Нет подключения к серверу ("+t+")"}))},makePOSTRequest(t,e){return fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e,null,2)}).then((t=>t.json())).catch((t=>{this.$refs.error.text=t}))},filterGoods(t){const e=new RegExp(t,"i");this.filteredGoods=this.goods.filter((t=>e.test(t.product_name)))},totalBasketAmount(){return this.basketItems.reduce(((t,e)=>t+e.price*e.quantity),0)},addProduct(t){let e=this.basketItems.find((e=>e.id_product==t.id_product));if(e)this.makePOSTRequest("/addToCart",e).then((t=>{1===t.result&&e.quantity++}));else{const e=Object.assign({quantity:1},t);this.makePOSTRequest("/addToCart",e).then((t=>{t.result&&this.basketItems.push(e)}))}},delProduct(t){let e=this.basketItems.find((e=>e.id_product==t.id_product));e.quantity>1?this.makePOSTRequest("/remoteFromCart",e).then((t=>{t.result&&e.quantity--})):this.makePOSTRequest("/remoteFromCart",t).then((t=>{t.result&&this.basketItems.splice(this.basketItems.indexOf(e),1)}))},formatPrice:t=>parseInt(t)?t+" руб":""},mounted(){this.makeGETRequest("/catalogData").then((t=>{this.goods=[...t],this.filteredGoods=[...t],document.querySelector(".modal-window").classList.remove("hide"),document.querySelector(".goods-list").classList.remove("hide")})),this.makeGETRequest("/basketData").then((t=>{this.basketItems=[...t]}))}});